/**
 * talqsInteraction v1.0.0
 * (c) 2017 JinJun He
 * @license MIT
 */
!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?module.exports=e():"function"==typeof define&&define.amd?define(e):t.TalqsInteraction=e()}(this,function(){"use strict";var t=function(){var t=function(){this._cache={}},e={cache:{}};return e.cache.set=function(t){var e=this;for(var a in t)e.set(a,t[a])},e.cache.get=function(){return this._cache},t.prototype.set=function(t,e){this._cache[t]=e,console.log(JSON.stringify(this._cache))},t.prototype.get=function(t){var e;return e=t?this._cache[t]:this._cache,JSON.stringify(e)},t.prototype.remove=function(t){delete this._cache[t]},Object.defineProperties(t.prototype,e),new t}(),e="update_talqs_cache_event",a=(function(a){var n="1.0.0",i="talqs.choice",o="."+i,s=".data-api",c={CLICK_DATA_API:"click"+o+s,UPDATE_CACHE_DATA_API:e},l={CHOICE_ITEM:"[data-option-item]",CHOICE_GROUP:"[data-option-group]",CHOICE_CONTAINER:'[data-talqs-type="choice"]'},r={QUE_ID:"data-que-id",LOGIC_TYPE:"data-logic-type",CHOICE_ITEM:"data-option-item",CHOICE_GROUP:"data-option-group"},d={ACTIVE:"active"},u=function(t,e,a,n){this._element=e,this._selected=a||[],this._config=n,this._queId=t},_={VERSION:{}};_.VERSION.get=function(){return n},u.prototype._updateClassState=function(t,e){var n=a(t).children().toArray();n&&n.forEach(function(t){var n=t.getAttribute(r.CHOICE_ITEM),i=n===e;Array.isArray(e)&&(i=!(e.indexOf(n)<0)),a(t).toggleClass(d.ACTIVE,i)})},u.prototype._updateStyleState=function(t){var e=this,n=a(this._element).find(l.CHOICE_GROUP).toArray();this._config.clozeChoice&&void 0!==t?this._updateClassState(a(n[t]),this._selected[t]):n.forEach(function(t,n){var i=e._config.clozeChoice?e._selected[n]:e._selected;e._updateClassState(a(t),i)})},u.prototype.updateSelectedState=function(e,a){if(a=parseInt(a,10),this._config.clozeChoice)this._selected[a]=this._selected[a]===e?"":e;else{var n=this._selected.indexOf(e);n<0?this._config.multipleChoice?this._selected.push(e):this._selected=[e]:this._selected.splice(n,1),this._selected.sort()}this._updateStyleState(a),t.set(this._queId,this._selected)},u.prototype.fillDataIntoComponent=function(t){this._selected=t,this._updateStyleState()},u.getConfig=function(t){t=parseInt(t,10);var e={multipleChoice:2===t,clozeChoice:10===t};return e},u._dataApiClickHandler=function(){var t=a(this).closest(l.CHOICE_CONTAINER)[0],e=t&&t.getAttribute(r.QUE_ID);if(e){var n=this.getAttribute(r.CHOICE_ITEM),i=this.parentElement,o=i&&i.getAttribute(r.CHOICE_GROUP);u._getInstance(e,t).updateSelectedState(n,o)}},u._getInstance=function(t,e){var n=a(e).data(i);if(!n){var o=e.getAttribute(r.LOGIC_TYPE),s=u.getConfig(o);n=new u(t,e,[],s),a(e).data(i,n)}return n},u._dataInitialHandler=function(){for(var e=a(l.CHOICE_CONTAINER).toArray(),n=e&&e.length||0,i=0;i<n;i++){var o=e[i],s=o.getAttribute(r.QUE_ID),c=t.cache[s];c&&u._getInstance(s,o).fillDataIntoComponent(c)}},Object.defineProperties(u,_),a(document).on(c.CLICK_DATA_API,l.CHOICE_ITEM,u._dataApiClickHandler),a(document).on(c.UPDATE_CACHE_DATA_API,u._dataInitialHandler)}(jQuery),function(a){var n="1.0.0",i="talqs.blank",o="."+i,s=".data-api",c={KEYUP_DATA_API:"keyup"+o+s,UPDATE_CACHE_DATA_API:e},l={QUE_ID:"data-que-id",BLANK_ITEM:"data-blank-item"},r={BLANK_ITEM:"[data-blank-item]",BLANK_CONTAINER:'[data-talqs-type="blank"]'},d=function(t,e,a){this._queId=t,this._element=e,this._blankData=a||[]},u={VERSION:{}};u.VERSION.get=function(){return n},d.prototype.updateBlankValueByIndex=function(e,a){e=parseInt(e,10),isNaN(e)||(this._blankData[e]=a,t.set(this._queId,this._blankData))},d.prototype.fillDataIntoComponent=function(t){var e=this;this._blankData=t;var n=a(this._element).find(r.BLANK_ITEM).toArray();n&&n.forEach(function(t,a){t.value=e._blankData[a]})},d._dataApiInputHandler=function(t){var e=a(this).closest(r.BLANK_CONTAINER)[0],n=e&&e.getAttribute(l.QUE_ID);if(n){var i=t.target.value;i=i.trim(),t.target.value=i;var o=this.getAttribute(l.BLANK_ITEM);d._getInstance(n,e).updateBlankValueByIndex(o,i)}},d._getInstance=function(t,e){var n=a(e).data(i);return n||(n=new d(t,e,[]),a(e).data(i,n)),n},d._dataInitialHandler=function(){for(var e=a(r.BLANK_CONTAINER).toArray(),n=e&&e.length||0,i=0;i<n;i++){var o=e[i],s=o.getAttribute(l.QUE_ID),c=t.cache[s];c&&d._getInstance(s,o).fillDataIntoComponent(c)}},Object.defineProperties(d,u),a(document).on(c.KEYUP_DATA_API,r.BLANK_ITEM,d._dataApiInputHandler),a(document).on(c.UPDATE_CACHE_DATA_API,d._dataInitialHandler)}(jQuery),function(a){var n="1.0.0",i="talqs.dropdown",o="."+i,s=".data-api",c={CHANGE:"change"+o+s,UPDATE_CACHE_DATA_API:e},l={DROPDOWN_ITEM:"[data-inputid]",DROPDOWN_CONTAINER:'[data-talqs-type="dropdown"]'},r={QUE_ID:"data-que-id",INPUTID:"data-inputid"},d=function(t,e,a){this._queId=t,this._element=e,this._selectData=a||[]},u={VERSION:{}};u.VERSION.get=function(){return n},d.prototype.updateBlankValueByIndex=function(e,a){e=parseInt(e,10),isNaN(e)||(this._selectData[e]=a,t.set(this._queId,this._selectData))},d.prototype.fillDataIntoComponent=function(t){var e=this;this._selectData=t;var n=a(this._element).find(l.DROPDOWN_ITEM).toArray();n&&n.forEach(function(t,a){t.value=e._selectData[a]})},d._dataApiSelectHandler=function(t){var e=a(this).closest(l.DROPDOWN_CONTAINER)[0],n=e&&e.getAttribute(r.QUE_ID);if(n){var i=t.target.value,o=this.getAttribute(r.INPUTID);d._getInstance(n,e).updateBlankValueByIndex(o,i)}},d._getInstance=function(t,e){var n=a(e).data(i);return n||(n=new d(t,e,[]),a(e).data(i,n)),n},d._dataInitialHandler=function(){for(var e=a(l.DROPDOWN_CONTAINER).toArray(),n=e&&e.length||0,i=0;i<n;i++){var o=e[i],s=o.getAttribute(r.QUE_ID),c=t.cache[s];c&&d._getInstance(s,o).fillDataIntoComponent(c)}},Object.defineProperties(d,u),a(document).on(c.CHANGE,l.DROPDOWN_ITEM,d._dataApiSelectHandler),a(document).on(c.UPDATE_CACHE_DATA_API,d._dataInitialHandler)}(jQuery),'class="talqs_content clearfix" data-que-id="{{data.queId}}"'),n="data-talqs-type",i="\n  {{if data.content && !data.hideContent}}\n    <div "+a+"\n      {{if data.logicQuesTypeId == 4}}\n        "+n+'="blank"\n      {{ else if data.logicQuesTypeId == 10 || data.logicQuesTypeId == 3}}\n        '+n+'="dropdown"\n      {{/if}}\n    >\n        {{#data.content | transfromBlankContent:data}}\n      </div>\n  {{/if}}\n',o="talqs_options",s={main:o,list:o+"_list",rows:o+"_rows",columns:o+"_columns",item:o+"_columns_item",index:o+"_index",label:o+"_label",content:o+"_content",clear:"clearfix"},c='\n{{ if data.answerOptionList && !data.isCloze}}\n    {{if data.logicQuesTypeId == 1 || data.logicQuesTypeId == 2}}\n      <div class="'+s.main+'" data-talqs-type="choice" data-que-id="{{data.queId}}" data-logic-type="{{data.logicQuesTypeId}}">\n          <ul class="'+s.list+'">\n            {{each data.answerOptionList}}\n              <li class="'+s.rows+'">\n                <ul class="'+s.columns+"_{{$value.length}} "+s.clear+'" data-option-group="{{$index}}">\n                  {{each $value}}\n                    <li class="'+s.item+" "+s.clear+'" data-option-item="{{$value.aoVal}}">\n                      <span class="'+s.label+'">{{$value.aoVal}}. </span>\n                      <div class="'+s.content+'">{{#$value.content}}</div>\n                    </li>\n                  {{/each}}\n                </ul>\n              </li>\n            {{/each}}\n          </ul>\n      </div>\n    {{/if}}\n{{/if}}',l={questionContent:i,questionOptions:c},r=/(?:&nbsp;)*<(?:u|span\s[^>]+)>(?:&nbsp;|\s){3,}(\d*)(?:&nbsp;|\s){3,}<\/(?:u|span)>(?:&nbsp;)*/g,d=[3,4,10],u={};u.transfromBlankContent=function(t,e){var a=parseInt(e.logicQuesTypeId,10);if(d.indexOf(a)!==-1){var n,i,o=-1;3===a&&(n=e.answerOptionList.map(function(t){return t[0]})),t=t.replace(r,function(t){if(o++,4===a)i='<input type="text" data-blank-item="'+o+'">';else{n=3===a?n:e.answerOptionList[o];var s=n.map(function(t){return'<option value="'+t.aoVal+'">'+t.content+"</option>"});i='\n              <span>\n                <select data-inputid="'+o+'">\n                  <option value></option>\n                  '+s.join("")+"\n                </select>\n              </span>\n          "}return i})}return t},function(t){t.registerComponent(l);for(var e in u)t.registerHelper(e,u[e])}(TalqsTemplate);var _={talqsStorageData:t,setInitialData:function(a){t.cache=a;var n=new Event(e);document.dispatchEvent(n)}};return _});